<!-- 請在 index.html 的 sidebar 中，將「投資媒合平台」改為： -->
<a href="script_database.html">SATA劇本資料庫</a>

<!-- 請替換 index.html 既有的 script -->
<script>
    window.onload = function() {
        if (localStorage.getItem("sata_login") === "true") {
            updateHeaderToLoggedIn();
        }
    }

    function toggleNav() { var s = document.getElementById("mySidebar"); var o = document.getElementById("overlay"); if(s.style.left==="0px"){s.style.left="-250px";o.style.display="none";}else{s.style.left="0px";o.style.display="block";} }
    function toggleLoginModal() { var m = document.getElementById("loginModal"); m.style.display = (m.style.display==="flex")?"none":"flex"; }
    
    function toggleMemberModal() { 
        var m = document.getElementById("memberModal"); 
        m.style.display = (m.style.display==="flex")?"none":"flex";
        // [新增] 打開會員視窗時，重新讀取投資列表
        if (m.style.display === "flex") renderMemberTable();
    }

    // [新增] 渲染投資表格 (讀取 localStorage)
    function renderMemberTable() {
        var tbody = document.querySelector(".manage-section:last-child tbody"); // 選取第二個表格的 tbody
        // 如果您的 index.html 結構不同，請給表格 tbody 一個 id="investment-table-body" 比較保險
        if (!tbody) return;

        var investments = JSON.parse(localStorage.getItem("sata_investments") || "[]");
        tbody.innerHTML = "";
        
        if (investments.length === 0) {
            tbody.innerHTML = "<tr><td colspan='3' style='text-align:center; color:#999;'>尚無投資意願</td></tr>";
        } else {
            investments.forEach(item => {
                tbody.innerHTML += `<tr><td>${item.title}</td><td>${item.type}</td><td><span class="status-tag tag-yes">${item.status}</span></td></tr>`;
            });
        }
    }

    function performLogin() {
        var u=document.getElementById("username").value; var p=document.getElementById("password").value;
        if(u==="123456"&&p==="123456"){ localStorage.setItem("sata_login","true"); toggleLoginModal(); updateHeaderToLoggedIn(); } else { alert("帳號或密碼錯誤"); }
    }
    function updateHeaderToLoggedIn() {
        document.getElementById("headerRightSection").innerHTML = `<span class="member-menu"><a href="javascript:void(0)" class="member-link" onclick="toggleMemberModal()">會員管理</a><span class="divider">|</span><a href="javascript:void(0)" class="member-link" onclick="performLogout()">登出</a></span>`;
    }
    function performLogout() {
        if(confirm("確定要登出嗎？")){ localStorage.removeItem("sata_login"); document.getElementById("headerRightSection").innerHTML=`<a href="javascript:void(0)" class="login-btn" onclick="toggleLoginModal()">登入</a>`; document.getElementById("memberModal").style.display="none"; }
    }
</script>
